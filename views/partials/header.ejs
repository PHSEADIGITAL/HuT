<!DOCTYPE html>
<html lang="en">
  <head>
    <% const safeAppName = typeof appName !== "undefined" ? appName : "Hut!"; %>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title ? `${title} | ${safeAppName}` : safeAppName %></title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <% const safeCurrentUser = typeof currentUser !== "undefined" ? currentUser : null; %>
    <% const safeCurrentPath = typeof currentPath === "string" ? currentPath : "/"; %>
    <% const safeFlash = typeof flash !== "undefined" ? flash : null; %>
    <header class="topbar">
      <div class="container topbar-inner">
        <a class="brand" href="/">Hut!</a>
        <nav class="nav">
          <a href="/">Stays</a>
          <a href="/marketplace">Marketplace</a>
          <% if (safeCurrentUser) { %>
            <a href="/wallet">Wallet</a>
          <% } %>
          <% if (safeCurrentUser && (safeCurrentUser.role === "hotel_admin" || safeCurrentUser.role === "platform_admin")) { %>
            <a href="/admin">Hotel Admin</a>
          <% } %>
          <% if (safeCurrentUser && safeCurrentUser.role === "platform_admin") { %>
            <a href="/admin/owner-dashboard">Owner Dashboard</a>
          <% } %>
          <% if (safeCurrentUser && safeCurrentUser.role === "platform_admin") { %>
            <a href="/admin/hotels/new">Onboard Hotel</a>
          <% } %>
        </nav>
        <div class="auth-actions">
          <% if (safeCurrentUser) { %>
            <span class="muted tiny">Signed in: <strong><%= safeCurrentUser.name %></strong> (<%= safeCurrentUser.role %>)</span>
            <form method="POST" action="/auth/logout">
              <button type="submit" class="ghost-btn">Logout</button>
            </form>
          <% } else { %>
            <a class="ghost-link" href="/auth/login">Sign in</a>
            <a class="button-link small" href="/auth/register">Create account</a>
          <% } %>
        </div>
      </div>
    </header>
    <section class="platform-tabs-wrap">
      <div class="container platform-tabs">
        <a class="platform-tab <%= safeCurrentPath === '/' || safeCurrentPath.startsWith('/hotels') ? 'active' : '' %>" href="/">Stays</a>
        <a class="platform-tab <%= safeCurrentPath.startsWith('/marketplace') ? 'active' : '' %>" href="/marketplace">Marketplace</a>
        <% if (safeCurrentUser) { %>
          <a class="platform-tab <%= safeCurrentPath.startsWith('/wallet') ? 'active' : '' %>" href="/wallet">Wallet</a>
        <% } %>
      </div>
    </section>
    <% if (safeFlash && safeFlash.message) { %>
      <section class="container flash <%= safeFlash.type === 'success' ? 'flash-success' : 'flash-error' %>">
        <p><%= safeFlash.message %></p>
      </section>
    <% } %>
    <main class="container">
