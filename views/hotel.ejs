<%- include("partials/header", { title: hotel.name }) %>

<section class="property-headline">
  <p class="muted tiny">
    <a href="/?destination=<%= encodeURIComponent(search.destination) %>&checkInDate=<%= checkInDate %>&checkOutDate=<%= checkOutDate %>&adults=<%= search.adults %>&rooms=<%= search.rooms %>">
      Back to search results
    </a>
  </p>
  <h1><%= hotel.name %></h1>
  <p class="muted"><%= "★".repeat(hotel.starRating) %> <%= hotel.propertyType %> • <%= hotel.location %></p>
  <% if (hotel.address) { %>
    <p class="muted tiny"><%= hotel.address %></p>
  <% } %>
  <div class="result-meta muted">
    <span><%= hotel.distanceToCenterKm %> km from center</span>
    <span><%= hotel.reviewLabel %> • <%= hotel.reviewScore %> / 10 (<%= hotel.reviewCount %> reviews)</span>
  </div>
</section>

<section class="property-gallery">
  <div class="property-main-photo">
    <img src="<%= hotel.coverImage %>" alt="<%= hotel.name %> main photo" />
  </div>
  <div class="property-thumb-grid">
    <% (hotel.galleryImages || []).slice(0, 4).forEach((image, index) => { %>
      <img src="<%= image %>" alt="<%= hotel.name %> gallery image <%= index + 1 %>" />
    <% }) %>
  </div>
</section>

<section class="property-layout">
  <div class="property-main-column">
    <article class="card">
      <h2>Property highlights</h2>
      <p><%= hotel.about || hotel.description %></p>
      <div class="chip-list">
        <% (hotel.amenities || []).forEach((item) => { %>
          <span class="chip"><%= item %></span>
        <% }) %>
      </div>
    </article>

    <article
      class="card"
      id="availability-root"
      data-hotel-id="<%= hotel.id %>"
      data-check-in="<%= checkInDate %>"
      data-check-out="<%= checkOutDate %>"
    >
      <h2>Available room types</h2>
      <form class="grid-form compact" method="GET" action="/hotels/<%= hotel.id %>">
        <input type="hidden" name="destination" value="<%= search.destination %>" />
        <input type="hidden" name="adults" value="<%= search.adults %>" />
        <input type="hidden" name="rooms" value="<%= search.rooms %>" />
        <div>
          <label for="checkInDate">Check-in</label>
          <input id="checkInDate" type="date" name="checkInDate" value="<%= checkInDate %>" required />
        </div>
        <div>
          <label for="checkOutDate">Check-out</label>
          <input
            id="checkOutDate"
            type="date"
            name="checkOutDate"
            value="<%= checkOutDate %>"
            required
          />
        </div>
        <div class="align-end">
          <button type="submit">Update availability</button>
        </div>
      </form>

      <div class="room-card-grid">
        <% rooms.forEach((room) => { %>
          <article class="room-card" data-room-id="<%= room.id %>">
            <img class="room-photo" src="<%= room.image %>" alt="<%= room.category %> room photo" />
            <div class="room-content">
              <div class="card-head">
                <h3><%= room.category %></h3>
                <span class="badge <%= room.availability.soldOut ? 'warn' : 'ok' %>">
                  <span class="availability-value <%= room.availability.soldOut ? 'danger' : 'success' %>"><%= room.availability.availableUnits %></span>
                  left
                </span>
              </div>
              <p class="muted tiny">
                <%= room.bedType %> • Sleeps up to <%= room.sleeps %> • <%= room.roomSizeSqm %> m²
              </p>
              <p class="muted">
                Price: <strong><%= formatNaira(room.pricePerNight) %></strong> per night
              </p>
              <p class="muted tiny">
                Booked for selected dates:
                <span class="booked-value"><%= room.totalUnits - room.availability.availableUnits %></span>
                of <%= room.totalUnits %>
              </p>
              <ul class="tiny muted">
                <% (room.highlights || []).slice(0, 3).forEach((item) => { %>
                  <li><%= item %></li>
                <% }) %>
              </ul>
            </div>
          </article>
        <% }) %>
      </div>
      <p class="muted tiny">Availability updates automatically when bookings or cancellations happen.</p>
    </article>

    <article class="card ideas">
      <h3>Cancellation policy: <%= hotel.cancellationPolicy %></h3>
      <ul>
        <% cancellationRules.forEach((rule) => { %>
          <li><%= rule %></li>
        <% }) %>
      </ul>
    </article>
  </div>

  <aside class="property-side-column">
    <article class="card sticky-booking">
      <h3>Your booking details</h3>
      <p class="muted tiny"><%= checkInDate %> - <%= checkOutDate %> • <%= search.adults %> adults • <%= search.rooms %> room(s)</p>
      <p class="price">From <strong><%= formatNaira(hotel.minPrice) %></strong> / night</p>
      <% if (!currentUser || currentUser.role !== "customer") { %>
        <p class="muted">Sign in to complete booking with secure payment.</p>
        <a
          class="button-link full-width"
          href="/auth/login?next=<%= encodeURIComponent(`/hotels/${hotel.id}?destination=${encodeURIComponent(search.destination)}&checkInDate=${checkInDate}&checkOutDate=${checkOutDate}&adults=${search.adults}&rooms=${search.rooms}`) %>"
        >
          Sign in to book
        </a>
      <% } else { %>
        <form class="grid-form" method="POST" action="/bookings">
          <input type="hidden" name="hotelId" value="<%= hotel.id %>" />

          <div class="full card subtle">
            <p class="tiny">
              Booking as <strong><%= currentUser.name %></strong><br />
              <span class="muted"><%= currentUser.email %> • <%= currentUser.phone %></span>
            </p>
          </div>

          <div class="full">
            <label for="roomId">Room category</label>
            <select id="roomId" name="roomId" required>
              <% rooms.forEach((room) => { %>
                <option value="<%= room.id %>">
                  <%= room.category %> - <%= formatNaira(room.pricePerNight) %>/night
                </option>
              <% }) %>
            </select>
          </div>

          <div>
            <label for="checkInBook">Check-in</label>
            <input id="checkInBook" name="checkInDate" type="date" value="<%= checkInDate %>" required />
          </div>
          <div>
            <label for="checkOutBook">Check-out</label>
            <input id="checkOutBook" name="checkOutDate" type="date" value="<%= checkOutDate %>" required />
          </div>

          <div>
            <label for="guests">Guests</label>
            <input id="guests" name="guests" type="number" min="1" value="<%= search.adults %>" required />
          </div>
          <div>
            <label for="emergencyContactName">Emergency contact name</label>
            <input id="emergencyContactName" name="emergencyContactName" type="text" required />
          </div>
          <div>
            <label for="emergencyContactPhone">Emergency contact phone</label>
            <input id="emergencyContactPhone" name="emergencyContactPhone" type="tel" required />
          </div>

          <div class="full">
            <label class="checkbox">
              <input type="checkbox" name="pickupRequested" />
              Add pickup service (<%= formatNaira(hotel.pickupFee) %>)
            </label>
          </div>
          <div class="full">
            <label for="specialRequest">Special requests</label>
            <textarea id="specialRequest" name="specialRequest" rows="2"></textarea>
          </div>
          <div class="full">
            <button type="submit" class="full-width">Reserve now</button>
          </div>
          <p class="muted tiny full">Secure checkout with fraud protection and instant SMS/email confirmation.</p>
        </form>
      <% } %>
    </article>
  </aside>
</section>

<%- include("partials/footer", { platform }) %>
