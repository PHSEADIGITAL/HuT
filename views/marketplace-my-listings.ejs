<%- include("partials/header", { title: "My Marketplace Listings" }) %>

<section class="hero small">
  <h1>My marketplace listings</h1>
  <p>Manage your items and monitor your monthly listing quota.</p>
</section>

<section class="stats-grid">
  <article class="card">
    <h3>Used this month</h3>
    <p class="metric"><%= limitState.used %> / <%= limitState.includedLimit %></p>
  </article>
  <article class="card">
    <h3>Remaining</h3>
    <p class="metric"><%= limitState.remaining %></p>
  </article>
  <article class="card">
    <h3>Total listings</h3>
    <p class="metric"><%= listings.length %></p>
  </article>
  <article class="card">
    <h3>Wallet balance</h3>
    <p class="metric"><%= formatNaira(walletBalance || 0) %></p>
  </article>
</section>

<section class="card">
  <div class="marketplace-actions">
    <a class="button-link" href="/marketplace/new">Create new listing</a>
    <a class="ghost-link" href="/marketplace">Open marketplace</a>
  </div>
</section>

<section class="card">
  <h3>Upgrade listing limit</h3>
  <% if (activePlanSubscriptions.length) { %>
    <p class="muted tiny">Active plans this month: <%= activePlanSubscriptions.map((item) => item.planName).join(", ") %></p>
  <% } %>
  <div class="marketplace-plan-grid">
    <% marketplacePlans.forEach((plan) => { %>
      <article class="card">
        <h4><%= plan.name %></h4>
        <p class="market-price"><%= formatNaira(plan.amount) %></p>
        <p class="muted tiny"><%= plan.description %></p>
        <p class="muted tiny">Adds <%= plan.extraListings %> listings/month</p>
        <form method="POST" action="/marketplace/plans/purchase">
          <input type="hidden" name="planId" value="<%= plan.id %>" />
          <button type="submit" class="ghost-btn">Buy with wallet</button>
        </form>
      </article>
    <% }) %>
  </div>
</section>

<section class="marketplace-grid">
  <% if (!listings.length) { %>
    <article class="card">
      <p class="muted">You have not listed any item yet.</p>
    </article>
  <% } %>
  <% listings.forEach((listing) => { %>
    <article class="card market-item-card">
      <a href="/marketplace/listings/<%= listing.id %>">
        <img src="<%= listing.primaryImage %>" alt="<%= listing.title %>" class="market-item-image" />
      </a>
      <div class="market-item-body">
        <h3><a href="/marketplace/listings/<%= listing.id %>"><%= listing.title %></a></h3>
        <p class="muted tiny">Status: <strong><%= listing.status %></strong></p>
        <p class="market-price"><%= formatNaira(listing.price) %></p>
        <% if (listing.status === "active") { %>
          <form method="POST" action="/marketplace/listings/<%= listing.id %>/mark-sold">
            <button type="submit" class="ghost-btn">Mark as sold</button>
          </form>
        <% } %>
      </div>
    </article>
  <% }) %>
</section>

<%- include("partials/footer", { platform }) %>
