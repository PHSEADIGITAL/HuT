<%- include("partials/header", { title: "Owner Revenue Dashboard" }) %>

<section class="hero small">
  <h1>Platform Owner Dashboard</h1>
  <p>One place for all hotel transactions, commissions, and platform revenue streams.</p>
</section>

<section class="stats-grid">
  <article class="card">
    <h3>Total payment records</h3>
    <p class="metric"><%= summary.paymentCount %></p>
  </article>
  <article class="card">
    <h3>Hotel transactions</h3>
    <p class="metric"><%= summary.hotelTransactionCount %></p>
  </article>
  <article class="card">
    <h3>Gross hotel volume</h3>
    <p class="metric"><%= formatNaira(summary.grossHotelVolume) %></p>
  </article>
  <article class="card">
    <h3>Hotel payouts</h3>
    <p class="metric"><%= formatNaira(summary.totalHotelPayouts) %></p>
  </article>
  <article class="card">
    <h3>Booking commissions</h3>
    <p class="metric"><%= formatNaira(summary.commissionRevenue) %></p>
  </article>
  <article class="card">
    <h3>Premium subscriptions</h3>
    <p class="metric"><%= formatNaira(summary.premiumRevenue) %></p>
  </article>
  <article class="card">
    <h3>Marketplace unlock fees</h3>
    <p class="metric"><%= formatNaira(summary.marketplaceRevenue) %></p>
  </article>
  <article class="card">
    <h3>Marketplace plan sales</h3>
    <p class="metric"><%= formatNaira(summary.marketplacePlanRevenue) %></p>
  </article>
  <article class="card">
    <h3>Net platform revenue</h3>
    <p class="metric"><%= formatNaira(summary.netPlatformRevenue) %></p>
  </article>
  <article class="card">
    <h3>User wallet liability</h3>
    <p class="metric"><%= formatNaira(summary.walletLiability) %></p>
  </article>
</section>

<section class="card">
  <h2>Hotel commission controls</h2>
  <p class="muted tiny">
    Update per-hotel commission percentages after onboarding. Changes apply to new bookings only.
  </p>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Hotel</th>
          <th>Location</th>
          <th>Current Commission</th>
          <th>Adjust</th>
          <th>Dashboard</th>
        </tr>
      </thead>
      <tbody>
        <% if (!hotels.length) { %>
          <tr>
            <td colspan="5" class="muted">No hotels found.</td>
          </tr>
        <% } %>
        <% hotels.forEach((hotel) => { %>
          <tr>
            <td><%= hotel.name %></td>
            <td><%= hotel.location %></td>
            <td><%= formatPercent(hotel.commissionRate || platform.defaultCommissionRate) %></td>
            <td>
              <details class="inline-editor compact">
                <summary>Adjust</summary>
                <form class="commission-form" method="POST" action="/admin/hotels/<%= hotel.id %>/commission">
                  <input type="hidden" name="returnTo" value="/admin/owner-dashboard" />
                  <div>
                    <label for="commission-<%= hotel.id %>">Commission (%)</label>
                    <input
                      id="commission-<%= hotel.id %>"
                      name="commissionRate"
                      type="number"
                      min="5"
                      max="30"
                      step="0.1"
                      value="<%= Number(((hotel.commissionRate || platform.defaultCommissionRate) * 100).toFixed(2)) %>"
                      required
                    />
                  </div>
                  <button type="submit">Save</button>
                </form>
              </details>
            </td>
            <td>
              <a class="ghost-link" href="/admin/hotels/<%= hotel.id %>/dashboard">Open</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</section>

<section class="card">
  <h2>All transactions (hotel + platform)</h2>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>Hotel</th>
          <th>User</th>
          <th>Reference</th>
          <th>Provider</th>
          <th>Gross</th>
          <th>Hotel Payout</th>
          <th>Platform Earning</th>
        </tr>
      </thead>
      <tbody>
        <% if (!paymentRows.length) { %>
          <tr><td colspan="9" class="muted">No transaction records available.</td></tr>
        <% } %>
        <% paymentRows.forEach((payment) => { %>
          <tr>
            <td><%= payment.createdAt %></td>
            <td><%= payment.transactionType %></td>
            <td><%= payment.hotelName %></td>
            <td><%= payment.userName %></td>
            <td><%= payment.transactionRef %></td>
            <td><%= payment.paymentProvider || "-" %></td>
            <td><%= formatNaira(payment.grossAmount) %></td>
            <td><%= formatNaira(payment.hotelPayout) %></td>
            <td><%= formatNaira(payment.platformEarning) %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</section>

<%- include("partials/footer", { platform }) %>
